import pyttsx3  # pip install pyttsx3
import speech_recognition as sr  # pip install speechRecognition
import datetime
import wikipedia  # pip install wikipedia
import webbrowser
import os
import time
import smtplib
import subprocess
import pyjokes
import win32com.client as wincl
from urllib.request import urlopen
from email.message import EmailMessage

engine = pyttsx3.init('sapi5')
voices = engine.getProperty('voices')
# print(voices[1].id)   #female voice
engine.setProperty('voice', voices[0].id)  #male voice


def speak(audio):
    engine.say(audio)
    engine.runAndWait()


def wishMe():
    hour = int(datetime.datetime.now().hour)
    if hour >= 0 and hour < 12:
        speak("Good Morning!")

    elif hour >= 12 and hour < 18:
        speak("Good Afternoon!")

    else:
        speak("Good Evening!")

    speak("Hey Vaishu, I am  your personal assistant. Please tell me how may I help you")

def send_email(receiver, subject, message):
    server = smtplib.SMTP('smtp.gmail.com', 587)
    server.starttls()
    # Make sure to give app access in your Google account
    server.login('pyprojectvirtual@gmail.com', '#password')
    email = EmailMessage()
    email['From'] = 'pyprojectvirtual@gmail.com'#user email
    email['To'] = receiver
    email['Subject'] = subject
    email.set_content(message)
    server.send_message(email)

email_list = {
    'vaishali': 'svaishu022@gmail.com',
    'valli': 'valliammai102000@gmail.com',
    'sharmila': 'sharmilaropheka@gmail.com',
    'kani': 'kanimozhianbuselvi@gmail.com',
  
}

def get_email_info():
    speak('To Whom you want to send email')
    name = takeCommand()
    receiver = email_list[name]
    print(receiver)
    speak('What is the subject of your email?')
    subject = takeCommand()
    speak('Tell me the text in your email')
    message = takeCommand()
    send_email(receiver, subject, message)
    speak('Hey lazy ass. Your email is sent')
    speak('Do you want to send more email?')
    send_more = takeCommand()
    if 'yes' in send_more:
        get_email_info()


def takeCommand():
    # It takes microphone input from the user and returns string output

    r = sr.Recognizer()
    with sr.Microphone() as source:
        print("Listening...")
        r.pause_threshold = 1
        audio = r.listen(source)

    try:
        print("Recognizing...")
        query = r.recognize_google(audio, language='en-in')
        print(f"User said: {query}\n")

    except Exception as e:
        # print(e)
        print("Say that again please...")
        return "None"
    return query


if __name__ == "__main__":
    wishMe()
    while True:

        query = takeCommand().lower()

        # Logic for executing tasks based on query
        if 'wikipedia' in query:
            speak('Searching Wikipedia...')
            query = query.replace("wikipedia", "")
            results = wikipedia.summary(query, sentences=2)
            speak("According to Wikipedia")
            print(results)
            speak(results)

        elif 'open youtube' in query:
            webbrowser.open("youtube.com")

        elif 'open google' in query:
            webbrowser.open("google.com")

        elif 'open stackoverflow' in query:
            webbrowser.open("stackoverflow.com")

        elif 'play online music' in query:
            webbrowser.open("gaana.com")

        elif 'shutdown' in query:
            subprocess.call(["shutdown", "/s"])

        elif 'restart' in query:
            subprocess.call(["shutdown", "/r"])

        elif 'online music in gaana' in query or 'gaana' in query:
            webbrowser.open("gaana.com")

        elif 'online music in spotify' in query or 'spotify' in query:
            webbrowser.open("spotify.com")

        elif 'time' in query:
            strTime = datetime.datetime.now().strftime("%H:%M:%S")
            speak("Mam, the time is {strTime}")

        elif 'open pycharm projects' in query:
            pycode = "C:\\Users\\Vaishali\\PycharmProjects"
            os.startfile(pycode)

        elif 'open sublime text' in query:
            sublime ="C:\\Program Files (x86)\\Sublime Text 3\\sublime_text.exe"
            os.startfile(sublime)

        elif 'mail' in query:
            get_email_info()
            send_email(receiver, subject, message)

        elif "teams" in query or "microsoft teams" in query:
            team = "C:\\Users\\Vaishali\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Microsoft Teams.lnk"
            os.startfile(team)


        elif "zoom meeting" in query:
            zoom ="C:\\Users\\Vaishali\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Zoom\\Zoom.lnk"
            os.startfile(zoom)

        elif "android studio" in query:
            android ="C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Android Studio\\Android Studio.lnk"
            os.startfile(android)

        elif 'joke' in query:
            speak(pyjokes.get_joke())


